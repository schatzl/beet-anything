<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Beet Anything - Crop Rotation & Companion Planting</title>
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="Smart garden planning with crop rotation and companion planting">
    <meta name="theme-color" content="#4a7c59">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Beet Anything">
    <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIkJlZXQgQW55dGhpbmciLAogICJzaG9ydF9uYW1lIjogIkJlZXQgQW55dGhpbmciLAogICJkZXNjcmlwdGlvbiI6ICJTbWFydCBnYXJkZW4gcGxhbm5pbmcgd2l0aCBjcm9wIHJvdGF0aW9uIGFuZCBjb21wYW5pb24gcGxhbnRpbmciLAogICJzdGFydF91cmwiOiAiLi8iLAogICJkaXNwbGF5IjogInN0YW5kYWxvbmUiLAogICJiYWNrZ3JvdW5kX2NvbG9yIjogIiNmNGYxZWEiLAogICJ0aGVtZV9jb2xvciI6ICIjNGE3YzU5IiwKICAib3JpZW50YXRpb24iOiAiYW55IiwKICAiaWNvbnMiOiBbCiAgICB7CiAgICAgICJzcmMiOiAiZGF0YTppbWFnZS9zdmcreG1sLCUzQ3N2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHZpZXdCb3g9JzAgMCAxMDAgMTAwJyUzRSUzQ3JlY3Qgd2lkdGg9JzEwMCcgaGVpZ2h0PScxMDAnIGZpbGw9JyUyMzRhN2M1OScvJTNFJTNDdGV4dCB4PSc1MCUyNScgeT0nNTAlMjUnIGZvbnQtc2l6ZT0nNTAnIHRleHQtYW5jaG9yPSdtaWRkbGUnIGRvbWluYW50LWJhc2VsaW5lPSdtaWRkbGUnJTNFJUYwJTlGJThDJUIxJTNDL3RleHQlM0UlM0Mvc3ZnJTNFIiwKICAgICAgInNpemVzIjogIjE5MngxOTIiLAogICAgICAidHlwZSI6ICJpbWFnZS9zdmcreG1sIiwKICAgICAgInB1cnBvc2UiOiAiYW55IG1hc2thYmxlIgogICAgfSwKICAgIHsKICAgICAgInNyYyI6ICJkYXRhOmltYWdlL3N2Zyt4bWwsJTNDc3ZnIHhtbG5zPSdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Zycgdmlld0JveD0nMCAwIDEwMCAxMDAnJTNFJTNDcmVjdCB3aWR0aD0nMTAwJyBoZWlnaHQ9JzEwMCcgZmlsbD0nJTIzNGE3YzU5Jy8lM0UlM0N0ZXh0IHg9JzUwJTI1JyB5PSc1MCUyNScgZm9udC1zaXplPSc1MCcgdGV4dC1hbmNob3I9J21pZGRsZScgZG9taW5hbnQtYmFzZWxpbmU9J21pZGRsZSclM0UlRjAlOUYlOEMlQjElM0MvdGV4dCUzRSUzQy9zdmclM0UiLAogICAgICAic2l6ZXMiOiAiNTEyeDUxMiIsCiAgICAgICJ0eXBlIjogImltYWdlL3N2Zyt4bWwiLAogICAgICAicHVycG9zZSI6ICJhbnkgbWFza2FibGUiCiAgICB9CiAgXQp9">
    <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' fill='%234a7c59'/%3E%3Ctext x='50%25' y='50%25' font-size='50' text-anchor='middle' dominant-baseline='middle'%3Eüå±%3C/text%3E%3C/svg%3E">
    
    <style>
        /* Inter Font from rsms.me */
        @import url('https://rsms.me/inter/inter.css');
        
        /* Inter Variable Font Support */
        @supports (font-variation-settings: normal) {
            body {
                font-family: 'Inter var', sans-serif;
            }
        }
        
        :root {
            --soil-dark: #3a2f28;
            --soil-medium: #5d4e3f;
            --leaf-green: #4a7c59;
            --sage: #8ba888;
            --cream: #f4f1ea;
            --terracotta: #c1694f;
            --sun-yellow: #e8b84d;
            --root-brown: #6b4423;
            --water-blue: #7ba8a8;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            font-feature-settings: 'liga' 1, 'calt' 1;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            background: var(--cream);
            color: var(--soil-dark);
            line-height: 1.6;
            overflow-x: hidden;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 30%, rgba(138, 168, 136, 0.03), transparent 40%),
                radial-gradient(circle at 80% 70%, rgba(193, 105, 79, 0.02), transparent 40%);
            pointer-events: none;
            z-index: 0;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
            position: relative;
            z-index: 1;
        }
        
        header {
            text-align: center;
            margin-bottom: 3rem;
            padding: 2rem 0;
            border-bottom: 2px solid var(--leaf-green);
            position: relative;
        }
        
        h1 {
            font-family: 'Inter', sans-serif;
            font-size: 3.5rem;
            color: var(--leaf-green);
            font-weight: 800;
            letter-spacing: -0.02em;
            margin-bottom: 0.5rem;
            animation: slideDown 0.8s ease-out;
        }
        
        .subtitle {
            font-size: 1.1rem;
            color: var(--soil-medium);
            font-weight: 300;
            font-style: italic;
            animation: fadeIn 1s ease-out 0.3s both;
        }
        
        .data-controls {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-top: 1rem;
            flex-wrap: wrap;
        }
        
        .language-switch {
            position: absolute;
            top: 1rem;
            right: 1rem;
            display: flex;
            gap: 0.5rem;
            background: white;
            border-radius: 20px;
            padding: 0.25rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .language-switch button {
            border: none;
            background: transparent;
            padding: 0.5rem 1rem;
            border-radius: 16px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            color: var(--soil-medium);
        }
        
        .language-switch button.active {
            background: var(--leaf-green);
            color: white;
        }
        
        .language-switch button:hover:not(.active) {
            background: var(--cream);
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 2rem;
            animation: fadeIn 1s ease-out 0.5s both;
        }
        
        .panel {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 4px 20px rgba(58, 47, 40, 0.08);
            border: 1px solid rgba(74, 124, 89, 0.1);
        }
        
        .panel h2 {
            font-family: 'Inter', sans-serif;
            font-weight: 700;
            color: var(--leaf-green);
            font-size: 1.8rem;
            margin-bottom: 1.5rem;
            border-bottom: 2px solid var(--sage);
            padding-bottom: 0.5rem;
        }
        
        .year-selector {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 2rem;
            padding: 1rem;
            background: linear-gradient(135deg, var(--sage) 0%, var(--leaf-green) 100%);
            border-radius: 8px;
            color: white;
        }
        
        .year-selector button {
            background: white;
            color: var(--leaf-green);
            border: none;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
        }
        
        .year-selector button:hover {
            transform: scale(1.1);
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }
        
        .year-display {
            font-family: 'Inter', sans-serif;
            font-weight: 700;
            font-size: 1.5rem;
            flex: 1;
            text-align: center;
        }
        
        .wishlist-section {
            margin-bottom: 2rem;
        }
        
        .wishlist-input {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }
        
        select, input, button {
            font-family: 'Inter', sans-serif;
            font-size: 1rem;
        }
        
        select, input[type="text"], input[type="number"] {
            flex: 1;
            padding: 0.75rem;
            border: 2px solid var(--sage);
            border-radius: 6px;
            background: var(--cream);
            color: var(--soil-dark);
            transition: all 0.3s ease;
        }
        
        select:focus, input:focus {
            outline: none;
            border-color: var(--leaf-green);
            background: white;
        }
        
        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-size: 0.9rem;
        }
        
        .btn-primary {
            background: var(--leaf-green);
            color: white;
        }
        
        .btn-primary:hover {
            background: var(--soil-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(74, 124, 89, 0.3);
        }
        
        .btn-secondary {
            background: var(--terracotta);
            color: white;
        }
        
        .btn-secondary:hover {
            background: var(--root-brown);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(193, 105, 79, 0.3);
        }
        
        .btn-small {
            padding: 0.5rem 1rem;
            font-size: 0.8rem;
        }
        
        .btn-suggest {
            width: 100%;
            background: linear-gradient(135deg, var(--sun-yellow) 0%, var(--terracotta) 100%);
            color: var(--soil-dark);
            font-size: 1.1rem;
            padding: 1rem;
            margin-top: 1rem;
        }
        
        .btn-suggest:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(232, 184, 77, 0.4);
        }
        
        .wishlist-items {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 1rem;
        }
        
        .wishlist-tag {
            background: var(--sage);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
            animation: popIn 0.3s ease-out;
        }
        
        @keyframes popIn {
            0% {
                opacity: 0;
                transform: scale(0.8);
            }
            100% {
                opacity: 1;
                transform: scale(1);
            }
        }
        
        .wishlist-tag button {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 1.2rem;
            line-height: 1;
            padding: 0;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .wishlist-tag button:hover {
            transform: scale(1.2);
        }
        
        .garden-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }
        
        .bed {
            background: linear-gradient(135deg, #f8f5ee 0%, #ebe6da 100%);
            border: 3px solid var(--soil-medium);
            border-radius: 10px;
            padding: 1.5rem;
            position: relative;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .bed:hover {
            transform: translateY(-4px);
            box-shadow: 0 6px 20px rgba(58, 47, 40, 0.15);
        }
        
        .bed-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--sage);
        }
        
        .bed-name {
            font-family: 'Inter', sans-serif;
            font-weight: 700;
            font-size: 1.3rem;
            color: var(--leaf-green);
        }
        
        .bed-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        .bed-actions button {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.2rem;
            padding: 0.25rem;
            transition: transform 0.2s ease;
        }
        
        .bed-actions button:hover {
            transform: scale(1.2);
        }
        
        .bed-content {
            min-height: 100px;
        }
        
        .plant-assignment {
            background: white;
            border-left: 4px solid var(--leaf-green);
            padding: 0.75rem;
            margin-bottom: 0.75rem;
            border-radius: 4px;
            transition: all 0.2s ease;
        }
        
        .plant-assignment:hover {
            background: var(--cream);
            border-left-width: 6px;
        }
        
        .plant-name {
            font-weight: 700;
            color: var(--leaf-green);
            margin-bottom: 0.25rem;
        }
        
        .plant-meta {
            font-size: 0.85rem;
            color: var(--soil-medium);
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }
        
        .nutrition-badge {
            padding: 0.15rem 0.5rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .nutrition-high {
            background: var(--terracotta);
            color: white;
        }
        
        .nutrition-medium {
            background: var(--sun-yellow);
            color: var(--soil-dark);
        }
        
        .nutrition-low {
            background: var(--sage);
            color: white;
        }
        
        .empty-bed {
            color: var(--soil-medium);
            font-style: italic;
            text-align: center;
            padding: 2rem 0;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(58, 47, 40, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease-out;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            animation: slideUp 0.3s ease-out;
        }
        
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--sage);
        }
        
        .modal-header h3 {
            font-family: 'Inter', sans-serif;
            font-weight: 700;
            color: var(--leaf-green);
            font-size: 1.8rem;
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 2rem;
            cursor: pointer;
            color: var(--soil-medium);
            line-height: 1;
        }
        
        .close-btn:hover {
            color: var(--terracotta);
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--soil-dark);
        }
        
        .companions-list {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 1rem;
        }
        
        .companion-tag {
            padding: 0.4rem 0.8rem;
            border-radius: 16px;
            font-size: 0.85rem;
            font-weight: 600;
        }
        
        .companion-good {
            background: #d4edda;
            color: #155724;
        }
        
        .companion-bad {
            background: #f8d7da;
            color: #721c24;
        }
        
        .suggestion-box {
            background: linear-gradient(135deg, #fff8e1 0%, #ffe7b8 100%);
            border: 2px solid var(--sun-yellow);
            border-radius: 8px;
            padding: 1.5rem;
            margin-top: 1.5rem;
        }
        
        .suggestion-box h4 {
            font-family: 'Inter', sans-serif;
            font-weight: 700;
            color: var(--root-brown);
            margin-bottom: 1rem;
        }
        
        .suggestion-item {
            background: white;
            padding: 1rem;
            margin-bottom: 0.75rem;
            border-radius: 6px;
            border-left: 4px solid var(--sun-yellow);
        }
        
        .suggestion-item strong {
            color: var(--leaf-green);
        }
        
        .info-text {
            background: var(--cream);
            padding: 1rem;
            border-radius: 6px;
            font-size: 0.9rem;
            color: var(--soil-medium);
            margin-bottom: 1rem;
            border-left: 3px solid var(--water-blue);
        }
        
        .compatibility-matrix {
            overflow-x: auto;
            margin-top: 1rem;
        }
        
        .compatibility-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85rem;
        }
        
        .compatibility-table th,
        .compatibility-table td {
            padding: 0.5rem;
            text-align: center;
            border: 1px solid var(--sage);
        }
        
        .compatibility-table th {
            background: var(--leaf-green);
            color: white;
            font-weight: 600;
            position: sticky;
            top: 0;
        }
        
        .compatibility-table tr:hover {
            background: var(--cream);
        }
        
        .compat-good {
            background: #d4edda;
            color: #155724;
        }
        
        .compat-bad {
            background: #f8d7da;
            color: #721c24;
        }
        
        .compat-neutral {
            background: #f8f9fa;
        }
        
        /* Mobile Optimizations */
        @media (max-width: 968px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
            
            h1 {
                font-size: 2.5rem;
            }
            
            .garden-grid {
                grid-template-columns: 1fr;
            }
        }
        
        /* iPhone and small smartphones */
        @media (max-width: 480px) {
            body {
                font-size: 0.95rem;
            }
            
            .container {
                padding: 1rem;
                max-width: 100%;
            }
            
            h1 {
                font-size: 2rem;
                letter-spacing: 0;
            }
            
            .subtitle {
                font-size: 0.95rem;
            }
            
            .panel {
                padding: 1rem;
                border-radius: 8px;
            }
            
            .panel h2 {
                font-size: 1.4rem;
                margin-bottom: 1rem;
            }
            
            .data-controls {
                flex-direction: column;
                gap: 0.5rem;
                margin-top: 1rem;
            }
            
            .data-controls .btn {
                width: 100%;
                padding: 0.6rem 1rem;
                font-size: 0.85rem;
            }
            
            .language-switch {
                position: static;
                margin: 1rem auto;
                justify-content: center;
            }
            
            .year-selector {
                padding: 0.75rem;
                margin-bottom: 1.5rem;
            }
            
            .year-display {
                font-size: 1.3rem;
            }
            
            .wishlist-input {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .wishlist-input select,
            .wishlist-input button {
                width: 100%;
            }
            
            .wishlist-tag {
                font-size: 0.85rem;
                padding: 0.4rem 0.8rem;
            }
            
            .btn {
                font-size: 0.85rem;
                padding: 0.65rem 1.2rem;
            }
            
            .btn-suggest {
                font-size: 1rem;
                padding: 0.85rem;
            }
            
            .bed {
                padding: 1rem;
            }
            
            .bed-name {
                font-size: 1.2rem;
            }
            
            .plant-assignment {
                padding: 0.6rem;
                margin-bottom: 0.6rem;
            }
            
            .plant-name {
                font-size: 0.95rem;
            }
            
            .plant-meta {
                font-size: 0.8rem;
                gap: 0.5rem;
            }
            
            .nutrition-badge {
                font-size: 0.7rem;
                padding: 0.1rem 0.4rem;
            }
            
            .companion-tag {
                font-size: 0.75rem;
                padding: 0.3rem 0.6rem;
            }
            
            .suggestion-box {
                padding: 1rem;
            }
            
            .suggestion-box h4 {
                font-size: 1.2rem;
            }
            
            .suggestion-item {
                padding: 0.75rem;
                margin-bottom: 0.6rem;
            }
            
            .modal-content {
                padding: 1.5rem;
                width: 95%;
                max-width: 95%;
            }
            
            .modal-header h3 {
                font-size: 1.5rem;
            }
            
            .form-group {
                margin-bottom: 1.2rem;
            }
            
            .info-text {
                font-size: 0.85rem;
                padding: 0.85rem;
            }
            
            .compatibility-table {
                font-size: 0.75rem;
            }
            
            .compatibility-table th,
            .compatibility-table td {
                padding: 0.3rem;
            }
            
            #floatingInstallButton {
                bottom: 10px !important;
                right: 10px !important;
                left: 10px !important;
                width: auto !important;
                font-size: 0.85rem !important;
                padding: 0.7rem 1rem !important;
            }
            
            #headerInstallButton {
                display: inline-block !important;
            }
        }
        
        /* Very small devices (iPhone SE, etc.) */
        @media (max-width: 375px) {
            h1 {
                font-size: 1.75rem;
            }
            
            .subtitle {
                font-size: 0.9rem;
            }
            
            .container {
                padding: 0.75rem;
            }
            
            .panel {
                padding: 0.85rem;
            }
            
            .year-display {
                font-size: 1.2rem;
            }
            
            .bed-name {
                font-size: 1.1rem;
            }
        }
        
        /* Landscape mode for smartphones */
        @media (max-width: 968px) and (orientation: landscape) {
            .main-grid {
                grid-template-columns: 1fr 1.5fr;
            }
            
            .year-selector {
                padding: 0.5rem;
            }
        }
        
        /* Prevent horizontal scroll on all devices */
        body, html {
            overflow-x: hidden;
            width: 100%;
            max-width: 100vw;
        }
        
        * {
            max-width: 100%;
        }
        
        /* Fix for buttons extending beyond viewport */
        .btn-suggest,
        .btn-secondary,
        .btn-primary {
            max-width: 100%;
            word-wrap: break-word;
            white-space: normal;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="language-switch">
                <button onclick="app.setLanguage('en')" class="active" id="langEN">EN</button>
                <button onclick="app.setLanguage('de')" id="langDE">DE</button>
                <button onclick="app.setLanguage('it')" id="langIT">IT</button>
            </div>
            
            <h1>üå± <span data-i18n="title">Beet Anything</span></h1>
            <p class="subtitle" data-i18n="subtitle">Crop Rotation & Companion Planting Made Easy</p>
            <div class="data-controls">
                <button class="btn btn-secondary btn-small" onclick="app.exportData()">
                    <span data-i18n="btn.export">üíæ Export Data</span>
                </button>
                <button class="btn btn-secondary btn-small" onclick="app.importData()">
                    <span data-i18n="btn.import">üìÇ Import Data</span>
                </button>
                <button class="btn btn-primary btn-small" onclick="app.showMatrix()">
                    <span data-i18n="btn.matrix">üìä View Matrix</span>
                </button>
                <button id="headerInstallButton" class="btn btn-primary btn-small" onclick="app.installAsApp()" style="display: none;">
                    <span data-i18n="btn.install">üì± Install as App</span>
                </button>
            </div>
        </header>
        
        <div class="main-grid">
            <!-- Left Panel: Controls -->
            <div>
                <div class="panel">
                    <h2 data-i18n="controls.title">Planning Controls</h2>
                    
                    <div class="year-selector">
                        <button onclick="app.changeYear(-1)">‚Üê</button>
                        <div class="year-display" id="yearDisplay">2024</div>
                        <button onclick="app.changeYear(1)">‚Üí</button>
                    </div>
                    
                    <div class="wishlist-section">
                        <h3 style="margin-bottom: 1rem; color: var(--soil-dark);" data-i18n="wishlist.title">Your Wishlist</h3>
                        <div class="wishlist-input">
                            <select id="vegetableSelect">
                                <option value="" data-i18n="wishlist.select">Select vegetable...</option>
                            </select>
                            <button class="btn btn-primary" onclick="app.addToWishlist()">
                                <span data-i18n="wishlist.add">Add</span>
                            </button>
                        </div>
                        <div class="wishlist-items" id="wishlistItems"></div>
                        
                        <button class="btn btn-suggest" onclick="app.generateSuggestions()">
                            <span data-i18n="suggestions.generate">‚ú® Suggest Garden Plan</span>
                        </button>
                        
                        <div id="suggestionsBox"></div>
                    </div>
                    
                    <div style="margin-top: 2rem;">
                        <button class="btn btn-secondary" style="width: 100%;" onclick="app.addBed()">
                            <span data-i18n="bed.add">+ Add Garden Bed</span>
                        </button>
                    </div>
                    
                    <div class="info-text" style="margin-top: 2rem;">
                        <strong data-i18n="info.title">üí° How it works:</strong><br>
                        <span data-i18n="info.text">Add vegetables to your wishlist, then click "Suggest Garden Plan" to get optimal bed assignments based on crop rotation and companion planting rules.</span>
                    </div>
                </div>
            </div>
            
            <!-- Right Panel: Garden Beds -->
            <div class="panel">
                <h2>
                    <span data-i18n="beds.title">Garden Beds</span> - 
                    <span id="yearDisplayBeds">2024</span>
                </h2>
                <div class="garden-grid" id="gardenGrid"></div>
            </div>
        </div>
    </div>
    
    <!-- Modal for Bed Assignment -->
    <div class="modal" id="bedModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 data-i18n="modal.assignPlants">Assign Plants</h3>
                <button class="close-btn" onclick="app.closeModal()">√ó</button>
            </div>
            <div id="modalBody"></div>
        </div>
    </div>
    
    <!-- Modal for Compatibility Matrix -->
    <div class="modal" id="matrixModal">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <h3 data-i18n="modal.matrix">Companion Planting Matrix</h3>
                <button class="close-btn" onclick="app.closeMatrixModal()">√ó</button>
            </div>
            <div id="matrixBody"></div>
        </div>
    </div>
    
    <script>
        // ============================================
        // INTERNATIONALIZATION (i18n)
        // ============================================
        
        const translations = {
            en: {
                title: "Beet Anything",
                subtitle: "Crop Rotation & Companion Planting Made Easy",
                "btn.export": "üíæ Export Data",
                "btn.import": "üìÇ Import Data",
                "btn.matrix": "üìä View Matrix",
                "btn.install": "üì± Install as App",
                "controls.title": "Planning Controls",
                "wishlist.title": "Your Wishlist",
                "wishlist.select": "Select vegetable...",
                "wishlist.add": "Add",
                "wishlist.empty": "No vegetables selected yet",
                "suggestions.generate": "‚ú® Suggest Garden Plan",
                "suggestions.title": "üåü Suggested Garden Plan",
                "suggestions.apply": "Apply to Bed",
                "suggestions.none": "No Suggestions Available",
                "suggestions.noneText": "Unable to place all vegetables. Try adding more beds or adjusting your wishlist.",
                "bed.add": "+ Add Garden Bed",
                "bed.remove": "Remove this bed and all its planting history?",
                "bed.empty": "Click to assign plants",
                "bed.previous": "Previous",
                "beds.title": "Garden Beds",
                "info.title": "üí° How it works:",
                "info.text": "Add vegetables to your wishlist, then click 'Suggest Garden Plan' to get optimal bed assignments based on crop rotation and companion planting rules.",
                "modal.assignPlants": "Assign Plants",
                "modal.bedName": "Bed Name",
                "modal.assignPlantsFor": "Assign Plants for",
                "modal.selectPlant": "Select plant...",
                "modal.addPlant": "Add Plant",
                "modal.currentPlants": "Current Plants",
                "modal.noPlants": "No plants assigned for this year",
                "modal.save": "Save",
                "modal.remove": "Remove",
                "modal.matrix": "Companion Planting Matrix",
                "matrix.legend": "Legend",
                "matrix.good": "Good companions",
                "matrix.bad": "Bad companions",
                "matrix.neutral": "Neutral",
                "nutrition.high": "high",
                "nutrition.medium": "medium",
                "nutrition.low": "low",
                "companion.with": "with",
                "reason.differentFamily": "Different plant family from previous year",
                "reason.sameFamily": "‚ö†Ô∏è Same plant family as previous year",
                "reason.restoresSoil": "Restores soil nutrients after heavy feeder",
                "reason.heavyAfterHeavy": "‚ö†Ô∏è High nutrient demand after heavy feeder",
                "reason.lowNutrient": "Low nutrient demand is soil-friendly",
                "reason.goodCompanion": "Good companion with",
                "reason.badCompanion": "‚ö†Ô∏è Poor companion with",
                "reason.samePlant2Years": "‚ö†Ô∏è Same vegetable was grown here 2 years ago",
                "install.alreadyInstalled": "The app is already installed! It's currently running as a PWA.",
                "install.iosTitle": "üì± App Installation on iPhone/iPad:",
                "install.iosSteps": "1. Tap the Share icon (‚ñ°‚Üë) at the bottom in Safari\n2. Scroll down\n3. Select 'Add to Home Screen'\n4. Tap 'Add'\n\nThe app will then appear on your home screen!\n\nNote: Only works in Safari (not Chrome/Firefox on iOS)",
                "install.androidTitle": "üì± App Installation on Android:",
                "install.androidSteps": "1. Open the Chrome menu (‚ãÆ) at the top right\n2. Select 'Install app' or 'Add to home screen'\n3. Confirm with 'Install'\n\nThe app will then appear on your home screen!",
                "install.desktopTitle": "üíª App Installation in Browser:",
                "install.desktopSteps": "Desktop (Chrome/Edge):\n1. Click the ‚äï icon in the address bar\n2. Or: Menu (‚ãÆ) ‚Üí 'Install app'\n3. Confirm with 'Install'\n\nMobile:\n- iPhone/Safari: Share (‚ñ°‚Üë) ‚Üí 'Add to Home Screen'\n- Android/Chrome: Menu (‚ãÆ) ‚Üí 'Install app'\n\nAdvantages:\n‚úì Works offline\n‚úì Faster startup\n‚úì Own app icon\n‚úì Fullscreen mode",
                "export.filename": "garden-plan",
                "import.success": "Data imported successfully!",
                "import.error": "Import failed. Please check the file format."
            },
            de: {
                title: "Beet Anything",
                subtitle: "Fruchtfolge & Mischkultur leicht gemacht",
                "btn.export": "üíæ Daten exportieren",
                "btn.import": "üìÇ Daten importieren",
                "btn.matrix": "üìä Matrix anzeigen",
                "btn.install": "üì± Als App installieren",
                "controls.title": "Planungssteuerung",
                "wishlist.title": "Ihre Wunschliste",
                "wishlist.select": "Gem√ºse ausw√§hlen...",
                "wishlist.add": "Hinzuf√ºgen",
                "wishlist.empty": "Noch kein Gem√ºse ausgew√§hlt",
                "suggestions.generate": "‚ú® Gartenplan vorschlagen",
                "suggestions.title": "üåü Vorgeschlagener Gartenplan",
                "suggestions.apply": "Auf Beet anwenden",
                "suggestions.none": "Keine Vorschl√§ge verf√ºgbar",
                "suggestions.noneText": "Alle Gem√ºsesorten konnten nicht platziert werden. Versuchen Sie, mehr Beete hinzuzuf√ºgen oder Ihre Wunschliste anzupassen.",
                "bed.add": "+ Gartenbeet hinzuf√ºgen",
                "bed.remove": "Dieses Beet und alle seine Pflanzungen entfernen?",
                "bed.empty": "Klicken zum Zuweisen von Pflanzen",
                "bed.previous": "Vorjahr",
                "beds.title": "Gartenbeete",
                "info.title": "üí° So funktioniert's:",
                "info.text": "F√ºgen Sie Gem√ºse zu Ihrer Wunschliste hinzu und klicken Sie dann auf 'Gartenplan vorschlagen', um optimale Beetzuweisungen basierend auf Fruchtfolge und Mischkulturregeln zu erhalten.",
                "modal.assignPlants": "Pflanzen zuweisen",
                "modal.bedName": "Beetname",
                "modal.assignPlantsFor": "Pflanzen zuweisen f√ºr",
                "modal.selectPlant": "Pflanze ausw√§hlen...",
                "modal.addPlant": "Pflanze hinzuf√ºgen",
                "modal.currentPlants": "Aktuelle Pflanzen",
                "modal.noPlants": "Keine Pflanzen f√ºr dieses Jahr zugewiesen",
                "modal.save": "Speichern",
                "modal.remove": "Entfernen",
                "modal.matrix": "Mischkultur-Matrix",
                "matrix.legend": "Legende",
                "matrix.good": "Gute Begleiter",
                "matrix.bad": "Schlechte Begleiter",
                "matrix.neutral": "Neutral",
                "nutrition.high": "hoher",
                "nutrition.medium": "mittlerer",
                "nutrition.low": "niedriger",
                "companion.with": "mit",
                "reason.differentFamily": "Andere Pflanzenfamilie als im Vorjahr",
                "reason.sameFamily": "‚ö†Ô∏è Gleiche Pflanzenfamilie wie im Vorjahr",
                "reason.restoresSoil": "Regeneriert Bodenn√§hrstoffe nach Starkzehrer",
                "reason.heavyAfterHeavy": "‚ö†Ô∏è Hoher N√§hrstoffbedarf nach Starkzehrer",
                "reason.lowNutrient": "Niedriger N√§hrstoffbedarf schont den Boden",
                "reason.goodCompanion": "Guter Begleiter von",
                "reason.badCompanion": "‚ö†Ô∏è Schlechter Begleiter von",
                "reason.samePlant2Years": "‚ö†Ô∏è Gleiches Gem√ºse wurde hier vor 2 Jahren angebaut",
                "install.alreadyInstalled": "Die App ist bereits installiert! Sie l√§uft gerade als PWA.",
                "install.iosTitle": "üì± App-Installation auf iPhone/iPad:",
                "install.iosSteps": "1. Tippen Sie auf das Teilen-Symbol (‚ñ°‚Üë) unten in Safari\n2. Scrollen Sie nach unten\n3. W√§hlen Sie 'Zum Home-Bildschirm'\n4. Tippen Sie auf 'Hinzuf√ºgen'\n\nDie App erscheint dann auf Ihrem Home-Bildschirm!\n\nHinweis: Funktioniert nur in Safari (nicht Chrome/Firefox auf iOS)",
                "install.androidTitle": "üì± App-Installation auf Android:",
                "install.androidSteps": "1. √ñffnen Sie das Chrome-Men√º (‚ãÆ) oben rechts\n2. W√§hlen Sie 'App installieren' oder 'Zum Startbildschirm hinzuf√ºgen'\n3. Best√§tigen Sie mit 'Installieren'\n\nDie App erscheint dann auf Ihrem Home-Bildschirm!",
                "install.desktopTitle": "üíª App-Installation im Browser:",
                "install.desktopSteps": "Desktop (Chrome/Edge):\n1. Klicken Sie auf das ‚äï Symbol in der Adressleiste\n2. Oder: Men√º (‚ãÆ) ‚Üí 'App installieren'\n3. Best√§tigen Sie mit 'Installieren'\n\nMobile:\n- iPhone/Safari: Teilen (‚ñ°‚Üë) ‚Üí 'Zum Home-Bildschirm'\n- Android/Chrome: Men√º (‚ãÆ) ‚Üí 'App installieren'\n\nVorteile:\n‚úì Offline nutzbar\n‚úì Schnellerer Start\n‚úì Eigenes App-Icon\n‚úì Vollbild-Modus",
                "export.filename": "gartenplan",
                "import.success": "Daten erfolgreich importiert!",
                "import.error": "Import fehlgeschlagen. Bitte √ºberpr√ºfen Sie das Dateiformat."
            },
            it: {
                title: "Beet Anything",
                subtitle: "Rotazione Colturale e Consociazione Facile",
                "btn.export": "üíæ Esporta Dati",
                "btn.import": "üìÇ Importa Dati",
                "btn.matrix": "üìä Visualizza Matrice",
                "btn.install": "üì± Installa come App",
                "controls.title": "Controlli di Pianificazione",
                "wishlist.title": "La Tua Lista Desideri",
                "wishlist.select": "Seleziona ortaggio...",
                "wishlist.add": "Aggiungi",
                "wishlist.empty": "Nessun ortaggio selezionato ancora",
                "suggestions.generate": "‚ú® Suggerisci Piano Orto",
                "suggestions.title": "üåü Piano Orto Suggerito",
                "suggestions.apply": "Applica all'Aiuola",
                "suggestions.none": "Nessun Suggerimento Disponibile",
                "suggestions.noneText": "Impossibile posizionare tutti gli ortaggi. Prova ad aggiungere pi√π aiuole o modificare la tua lista desideri.",
                "bed.add": "+ Aggiungi Aiuola",
                "bed.remove": "Rimuovere questa aiuola e tutta la sua cronologia di piantagione?",
                "bed.empty": "Clicca per assegnare piante",
                "bed.previous": "Anno Precedente",
                "beds.title": "Aiuole dell'Orto",
                "info.title": "üí° Come funziona:",
                "info.text": "Aggiungi ortaggi alla tua lista desideri, poi clicca 'Suggerisci Piano Orto' per ottenere assegnazioni ottimali basate sulla rotazione colturale e regole di consociazione.",
                "modal.assignPlants": "Assegna Piante",
                "modal.bedName": "Nome Aiuola",
                "modal.assignPlantsFor": "Assegna Piante per",
                "modal.selectPlant": "Seleziona pianta...",
                "modal.addPlant": "Aggiungi Pianta",
                "modal.currentPlants": "Piante Attuali",
                "modal.noPlants": "Nessuna pianta assegnata per quest'anno",
                "modal.save": "Salva",
                "modal.remove": "Rimuovi",
                "modal.matrix": "Matrice di Consociazione",
                "matrix.legend": "Legenda",
                "matrix.good": "Buoni compagni",
                "matrix.bad": "Cattivi compagni",
                "matrix.neutral": "Neutro",
                "nutrition.high": "alto",
                "nutrition.medium": "medio",
                "nutrition.low": "basso",
                "companion.with": "con",
                "reason.differentFamily": "Famiglia di piante diversa dall'anno precedente",
                "reason.sameFamily": "‚ö†Ô∏è Stessa famiglia di piante dell'anno precedente",
                "reason.restoresSoil": "Ripristina i nutrienti del suolo dopo pianta esigente",
                "reason.heavyAfterHeavy": "‚ö†Ô∏è Alta richiesta di nutrienti dopo pianta esigente",
                "reason.lowNutrient": "Bassa richiesta di nutrienti preserva il suolo",
                "reason.goodCompanion": "Buon compagno con",
                "reason.badCompanion": "‚ö†Ô∏è Cattivo compagno con",
                "reason.samePlant2Years": "‚ö†Ô∏è Stesso ortaggio coltivato qui 2 anni fa",
                "install.alreadyInstalled": "L'app √® gi√† installata! Sta funzionando come PWA.",
                "install.iosTitle": "üì± Installazione App su iPhone/iPad:",
                "install.iosSteps": "1. Tocca l'icona Condividi (‚ñ°‚Üë) in basso in Safari\n2. Scorri verso il basso\n3. Seleziona 'Aggiungi a Home'\n4. Tocca 'Aggiungi'\n\nL'app apparir√† sulla tua schermata home!\n\nNota: Funziona solo in Safari (non Chrome/Firefox su iOS)",
                "install.androidTitle": "üì± Installazione App su Android:",
                "install.androidSteps": "1. Apri il menu Chrome (‚ãÆ) in alto a destra\n2. Seleziona 'Installa app' o 'Aggiungi a schermata Home'\n3. Conferma con 'Installa'\n\nL'app apparir√† sulla tua schermata home!",
                "install.desktopTitle": "üíª Installazione App nel Browser:",
                "install.desktopSteps": "Desktop (Chrome/Edge):\n1. Clicca sull'icona ‚äï nella barra degli indirizzi\n2. Oppure: Menu (‚ãÆ) ‚Üí 'Installa app'\n3. Conferma con 'Installa'\n\nMobile:\n- iPhone/Safari: Condividi (‚ñ°‚Üë) ‚Üí 'Aggiungi a Home'\n- Android/Chrome: Menu (‚ãÆ) ‚Üí 'Installa app'\n\nVantaggi:\n‚úì Funziona offline\n‚úì Avvio pi√π veloce\n‚úì Icona app propria\n‚úì Modalit√† schermo intero",
                "export.filename": "piano-orto",
                "import.success": "Dati importati con successo!",
                "import.error": "Importazione fallita. Controlla il formato del file."
            }
        };
        
        // ============================================
        // CORE CLASS HIERARCHY (English names)
        // ============================================
        
        /**
         * Base class for vegetable information
         */
        class Vegetable {
            constructor(id, nameEN, nameDE, nameIT, nutrition, family) {
                this.id = id;
                this.nameEN = nameEN;
                this.nameDE = nameDE;
                this.nameIT = nameIT;
                this.nutrition = nutrition; // 'high', 'medium', 'low'
                this.family = family;
                this.goodCompanions = [];
                this.badCompanions = [];
            }
            
            addGoodCompanion(vegetableId) {
                if (!this.goodCompanions.includes(vegetableId)) {
                    this.goodCompanions.push(vegetableId);
                }
            }
            
            addBadCompanion(vegetableId) {
                if (!this.badCompanions.includes(vegetableId)) {
                    this.badCompanions.push(vegetableId);
                }
            }
            
            isCompatibleWith(vegetableId) {
                if (this.badCompanions.includes(vegetableId)) return -1;
                if (this.goodCompanions.includes(vegetableId)) return 1;
                return 0;
            }
            
            getName(lang = 'en') {
                if (lang === 'de') return this.nameDE;
                if (lang === 'it') return this.nameIT;
                return this.nameEN;
            }
            
            toJSON() {
                return {
                    id: this.id,
                    nameEN: this.nameEN,
                    nameDE: this.nameDE,
                    nameIT: this.nameIT,
                    nutrition: this.nutrition,
                    family: this.family,
                    goodCompanions: this.goodCompanions,
                    badCompanions: this.badCompanions
                };
            }
            
            static fromJSON(data) {
                const veg = new Vegetable(data.id, data.nameEN, data.nameDE, data.nameIT, data.nutrition, data.family);
                veg.goodCompanions = data.goodCompanions || [];
                veg.badCompanions = data.badCompanions || [];
                return veg;
            }
        }
        
        /**
         * Represents a planting in a specific bed and year
         */
        class Planting {
            constructor(bedId, year, vegetableId) {
                this.bedId = bedId;
                this.year = year;
                this.vegetableId = vegetableId;
            }
            
            toJSON() {
                return {
                    bedId: this.bedId,
                    year: this.year,
                    vegetableId: this.vegetableId
                };
            }
            
            static fromJSON(data) {
                return new Planting(data.bedId, data.year, data.vegetableId);
            }
        }
        
        /**
         * Represents a garden bed
         */
        class GardenBed {
            constructor(id, name) {
                this.id = id;
                this.name = name;
            }
            
            toJSON() {
                return {
                    id: this.id,
                    name: this.name
                };
            }
            
            static fromJSON(data) {
                return new GardenBed(data.id, data.name);
            }
        }
        
        /**
         * Manages the entire garden with all its data
         */
        class GardenManager {
            constructor() {
                this.vegetables = new Map();
                this.beds = new Map();
                this.plantings = [];
                this.initializeVegetableDatabase();
            }
            
            initializeVegetableDatabase() {
                // Initialize vegetables with EN, DE and IT names
                const veggies = [
                    new Vegetable('tomato', 'Tomato', 'Tomate', 'Pomodoro', 'high', 'Solanaceae'),
                    new Vegetable('potato', 'Potato', 'Kartoffel', 'Patata', 'high', 'Solanaceae'),
                    new Vegetable('carrot', 'Carrot', 'Karotte', 'Carota', 'low', 'Apiaceae'),
                    new Vegetable('lettuce', 'Lettuce', 'Salat', 'Lattuga', 'low', 'Asteraceae'),
                    new Vegetable('cabbage', 'Cabbage', 'Kohl', 'Cavolo', 'high', 'Brassicaceae'),
                    new Vegetable('beans', 'Beans', 'Bohnen', 'Fagioli', 'low', 'Fabaceae'),
                    new Vegetable('peas', 'Peas', 'Erbsen', 'Piselli', 'low', 'Fabaceae'),
                    new Vegetable('onion', 'Onion', 'Zwiebel', 'Cipolla', 'medium', 'Amaryllidaceae'),
                    new Vegetable('garlic', 'Garlic', 'Knoblauch', 'Aglio', 'medium', 'Amaryllidaceae'),
                    new Vegetable('cucumber', 'Cucumber', 'Gurke', 'Cetriolo', 'medium', 'Cucurbitaceae'),
                    new Vegetable('zucchini', 'Zucchini', 'Zucchini', 'Zucchina', 'medium', 'Cucurbitaceae'),
                    new Vegetable('corn', 'Corn', 'Mais', 'Mais', 'high', 'Poaceae'),
                    new Vegetable('radish', 'Radish', 'Radieschen', 'Ravanello', 'low', 'Brassicaceae'),
                    new Vegetable('spinach', 'Spinach', 'Spinat', 'Spinaci', 'medium', 'Amaranthaceae'),
                    new Vegetable('basil', 'Basil', 'Basilikum', 'Basilico', 'low', 'Lamiaceae'),
                    new Vegetable('pepper', 'Pepper', 'Paprika', 'Peperone', 'medium', 'Solanaceae'),
                    new Vegetable('celery', 'Celery', 'Sellerie', 'Sedano', 'high', 'Apiaceae'),
                    new Vegetable('arugula', 'Arugula', 'Rucola', 'Rucola', 'low', 'Brassicaceae'),
                    new Vegetable('kohlrabi', 'Kohlrabi', 'Kohlrabi', 'Cavolo Rapa', 'medium', 'Brassicaceae'),
                    new Vegetable('leek', 'Leek', 'Lauch', 'Porro', 'medium', 'Amaryllidaceae'),
                ];
                
                veggies.forEach(v => this.vegetables.set(v.id, v));
                
                // Set up companion planting relationships
                this.setCompanions('tomato', ['basil', 'carrot', 'lettuce', 'celery'], ['potato', 'cabbage', 'peas']);
                this.setCompanions('potato', ['beans', 'corn', 'cabbage'], ['tomato', 'cucumber', 'pepper']);
                this.setCompanions('carrot', ['tomato', 'lettuce', 'onion', 'leek'], ['celery']);
                this.setCompanions('lettuce', ['carrot', 'radish', 'kohlrabi'], ['celery']);
                this.setCompanions('cabbage', ['beans', 'potato', 'celery'], ['tomato', 'onion', 'garlic']);
                this.setCompanions('beans', ['corn', 'cabbage', 'potato', 'cucumber'], ['onion', 'garlic', 'leek']);
                this.setCompanions('peas', ['carrot', 'radish', 'kohlrabi'], ['onion', 'garlic', 'leek', 'tomato']);
                this.setCompanions('onion', ['carrot', 'lettuce', 'tomato'], ['beans', 'peas', 'cabbage']);
                this.setCompanions('garlic', ['tomato', 'cucumber'], ['beans', 'peas', 'cabbage']);
                this.setCompanions('cucumber', ['beans', 'corn', 'peas', 'garlic'], ['potato', 'radish']);
                this.setCompanions('zucchini', ['beans', 'corn', 'onion'], ['potato']);
                this.setCompanions('corn', ['beans', 'cucumber', 'peas', 'zucchini'], ['tomato', 'celery']);
                this.setCompanions('radish', ['lettuce', 'peas', 'carrot'], ['cucumber']);
                this.setCompanions('spinach', ['peas', 'kohlrabi', 'radish'], []);
                this.setCompanions('basil', ['tomato', 'pepper', 'cucumber'], []);
                this.setCompanions('pepper', ['basil', 'onion', 'carrot'], ['beans', 'potato']);
                this.setCompanions('celery', ['cabbage', 'leek', 'tomato'], ['carrot', 'lettuce', 'corn']);
                this.setCompanions('arugula', ['beans', 'peas', 'radish'], []);
                this.setCompanions('kohlrabi', ['lettuce', 'peas', 'spinach'], []);
                this.setCompanions('leek', ['celery', 'carrot', 'tomato'], ['beans', 'peas']);
            }
            
            setCompanions(vegId, good, bad) {
                const veg = this.vegetables.get(vegId);
                if (!veg) return;
                
                good.forEach(g => {
                    if (this.vegetables.has(g)) {
                        veg.addGoodCompanion(g);
                    }
                });
                
                bad.forEach(b => {
                    if (this.vegetables.has(b)) {
                        veg.addBadCompanion(b);
                    }
                });
            }
            
            addBed(name) {
                const id = Date.now();
                const beet = new GardenBed(id, name || `Bed ${this.beds.size + 1}`);
                this.beds.set(id, bed);
                return bed;
            }
            
            removeBed(bedId) {
                this.beds.delete(bedId);
                this.plantings = this.plantings.filter(p => p.bedId !== bedId);
            }
            
            addPlanting(bedId, year, vegetableId) {
                this.plantings = this.plantings.filter(
                    p => !(p.bedId === bedId && p.year === year && p.vegetableId === vegetableId)
                );
                this.plantings.push(new Planting(bedId, year, vegetableId));
            }
            
            removePlanting(bedId, year, vegetableId) {
                this.plantings = this.plantings.filter(
                    p => !(p.bedId === bedId && p.year === year && p.vegetableId === vegetableId)
                );
            }
            
            getPlantingsForBed(bedId, year) {
                return this.plantings
                    .filter(p => p.bedId === bedId && p.year === year)
                    .map(p => this.vegetables.get(p.vegetableId))
                    .filter(v => v);
            }
            
            getPlantingIdsForBed(bedId, year) {
                return this.plantings
                    .filter(p => p.bedId === bedId && p.year === year)
                    .map(p => p.vegetableId);
            }
            
            exportData() {
                return JSON.stringify({
                    vegetables: Array.from(this.vegetables.values()).map(v => v.toJSON()),
                    beds: Array.from(this.beds.values()).map(b => b.toJSON()),
                    plantings: this.plantings.map(p => p.toJSON())
                }, null, 2);
            }
            
            importData(jsonString) {
                try {
                    const data = JSON.parse(jsonString);
                    
                    this.vegetables.clear();
                    data.vegetables.forEach(v => {
                        const veg = Vegetable.fromJSON(v);
                        this.vegetables.set(veg.id, veg);
                    });
                    
                    this.beds.clear();
                    data.beds.forEach(b => {
                        const bed = GardenBed.fromJSON(b);
                        this.beds.set(bed.id, bed);
                    });
                    
                    this.plantings = data.plantings.map(p => Planting.fromJSON(p));
                    
                    return true;
                } catch (e) {
                    console.error('Import failed:', e);
                    return false;
                }
            }
            
            saveToLocalStorage() {
                localStorage.setItem('beetAnythingData', this.exportData());
            }
            
            loadFromLocalStorage() {
                const data = localStorage.getItem('beetAnythingData');
                if (data) {
                    return this.importData(data);
                }
                return false;
            }
        }
        
        // ============================================
        // SUGGESTION ALGORITHM
        // ============================================
        
        class SuggestionEngine {
            constructor(gardenManager) {
                this.garden = gardenManager;
            }
            
            generateSuggestions(wishlist, currentYear) {
                const suggestions = [];
                const beds = Array.from(this.garden.beds.values());
                const usedVeggies = new Set();
                
                const bedScores = [];
                
                for (const bed of beds) {
                    for (const vegId of wishlist) {
                        if (usedVeggies.has(vegId)) continue;
                        
                        const score = this.scorePlantingOption(bed.id, vegId, currentYear);
                        bedScores.push({
                            bedId: bed.id,
                            bedName: bed.name,
                            vegId: vegId,
                            score: score.total,
                            reasons: score.reasons
                        });
                    }
                }
                
                bedScores.sort((a, b) => b.score - a.score);
                
                const assignedBeds = new Set();
                
                for (const option of bedScores) {
                    if (usedVeggies.has(option.vegId) || assignedBeds.has(option.bedId)) {
                        continue;
                    }
                    
                    suggestions.push({
                        bedId: option.bedId,
                        bedName: option.bedName,
                        vegId: option.vegId,
                        vegetableName: this.garden.vegetables.get(option.vegId).getName(app.currentLanguage),
                        score: option.score,
                        reasons: option.reasons
                    });
                    
                    usedVeggies.add(option.vegId);
                    assignedBeds.add(option.bedId);
                }
                
                return suggestions;
            }
            
            scorePlantingOption(bedId, vegId, year) {
                const veg = this.garden.vegetables.get(vegId);
                if (!veg) return { total: 0, reasons: [] };
                
                let score = 0;
                const reasons = [];
                
                const prevYear = this.garden.getPlantingIdsForBed(bedId, year - 1);
                const currentYear = this.garden.getPlantingIdsForBed(bedId, year);
                
                // Rule 1: Family rotation
                const prevFamilies = prevYear.map(id => this.garden.vegetables.get(id)?.family).filter(f => f);
                if (!prevFamilies.includes(veg.family)) {
                    score += 30;
                    reasons.push('reason.differentFamily');
                } else {
                    score -= 20;
                    reasons.push('reason.sameFamily');
                }
                
                // Rule 2: Nutrition rotation
                const prevNutrition = prevYear.map(id => this.garden.vegetables.get(id)?.nutrition).filter(n => n);
                if (prevNutrition.includes('high') && veg.nutrition === 'low') {
                    score += 25;
                    reasons.push('reason.restoresSoil');
                } else if (prevNutrition.includes('high') && veg.nutrition === 'high') {
                    score -= 15;
                    reasons.push('reason.heavyAfterHeavy');
                } else if (veg.nutrition === 'low') {
                    score += 10;
                    reasons.push('reason.lowNutrient');
                }
                
                // Rule 3: Companion planting
                for (const currentVegId of currentYear) {
                    const compatibility = veg.isCompatibleWith(currentVegId);
                    if (compatibility === 1) {
                        score += 15;
                        reasons.push(`reason.goodCompanion:${currentVegId}`);
                    } else if (compatibility === -1) {
                        score -= 30;
                        reasons.push(`reason.badCompanion:${currentVegId}`);
                    }
                }
                
                // Rule 4: Prefer empty beds
                if (currentYear.length === 0) {
                    score += 5;
                }
                
                // Rule 5: Two-year rotation
                const twoYearsAgo = this.garden.getPlantingIdsForBed(bedId, year - 2);
                if (twoYearsAgo.includes(vegId)) {
                    score -= 10;
                    reasons.push('reason.samePlant2Years');
                }
                
                return { total: score, reasons };
            }
        }
        
        // ============================================
        // APPLICATION CONTROLLER
        // ============================================
        
        const app = {
            garden: new GardenManager(),
            suggestionEngine: null,
            currentYear: 2024,
            wishlist: [],
            currentLanguage: 'en',
            
            init() {
                // Try to load saved data
                const loaded = this.garden.loadFromLocalStorage();
                
                // Load app state
                const state = localStorage.getItem('beetAnythingState');
                if (state) {
                    try {
                        const parsedState = JSON.parse(state);
                        this.currentYear = parsedState.currentYear || 2024;
                        this.wishlist = parsedState.wishlist || [];
                        this.currentLanguage = parsedState.language || 'en';
                        
                        document.getElementById('yearDisplay').textContent = this.currentYear;
                        document.getElementById('yearDisplayBeds').textContent = this.currentYear;
                    } catch (e) {
                        console.log('State could not be loaded:', e);
                    }
                }
                
                // If no saved data, initialize with default beds
                if (!loaded) {
                    for (let i = 0; i < 4; i++) {
                        this.garden.addBed(`Bed ${i + 1}`);
                    }
                    this.save();
                }
                
                this.suggestionEngine = new SuggestionEngine(this.garden);
                
                // Populate vegetable select
                this.populateVegetableSelect();
                
                // Set language
                this.setLanguage(this.currentLanguage, false);
                
                this.render();
            },
            
            setLanguage(lang, save = true) {
                this.currentLanguage = lang;
                
                // Update language switch buttons
                document.querySelectorAll('.language-switch button').forEach(btn => {
                    btn.classList.remove('active');
                });
                document.getElementById(`lang${lang.toUpperCase()}`).classList.add('active');
                
                // Update all translatable elements
                document.querySelectorAll('[data-i18n]').forEach(el => {
                    const key = el.getAttribute('data-i18n');
                    if (translations[lang][key]) {
                        el.textContent = translations[lang][key];
                    }
                });
                
                // Re-populate vegetable select with translated names
                this.populateVegetableSelect();
                
                // Re-render to update vegetable names
                this.render();
                
                if (save) {
                    this.save();
                }
            },
            
            t(key, replacements = {}) {
                let text = translations[this.currentLanguage][key] || key;
                
                // Handle replacements like {name}
                Object.keys(replacements).forEach(replaceKey => {
                    text = text.replace(`{${replaceKey}}`, replacements[replaceKey]);
                });
                
                return text;
            },
            
            populateVegetableSelect() {
                const select = document.getElementById('vegetableSelect');
                const currentValue = select.value;
                
                // Clear and re-populate
                select.innerHTML = `<option value="">${this.t('wishlist.select')}</option>`;
                
                const sortedVeggies = Array.from(this.garden.vegetables.values())
                    .sort((a, b) => a.getName(this.currentLanguage).localeCompare(b.getName(this.currentLanguage)));
                
                sortedVeggies.forEach(veg => {
                    const option = document.createElement('option');
                    option.value = veg.id;
                    option.textContent = veg.getName(this.currentLanguage);
                    select.appendChild(option);
                });
                
                // Restore selection if it was set
                if (currentValue) {
                    select.value = currentValue;
                }
            },
            
            changeYear(delta) {
                this.currentYear += delta;
                document.getElementById('yearDisplay').textContent = this.currentYear;
                document.getElementById('yearDisplayBeds').textContent = this.currentYear;
                this.save();
                this.render();
            },
            
            addToWishlist() {
                const select = document.getElementById('vegetableSelect');
                const vegId = select.value;
                if (vegId && !this.wishlist.includes(vegId)) {
                    this.wishlist.push(vegId);
                    select.value = '';
                    this.save();
                    this.renderWishlist();
                }
            },
            
            removeFromWishlist(vegId) {
                this.wishlist = this.wishlist.filter(v => v !== vegId);
                this.save();
                this.renderWishlist();
            },
            
            renderWishlist() {
                const container = document.getElementById('wishlistItems');
                if (this.wishlist.length === 0) {
                    container.innerHTML = `<p style="color: var(--soil-medium); font-style: italic;">${this.t('wishlist.empty')}</p>`;
                    return;
                }
                
                container.innerHTML = this.wishlist.map(vegId => {
                    const veg = this.garden.vegetables.get(vegId);
                    if (!veg) return '';
                    return `
                        <div class="wishlist-tag">
                            ${veg.getName(this.currentLanguage)}
                            <button onclick="app.removeFromWishlist('${vegId}')">√ó</button>
                        </div>
                    `;
                }).join('');
            },
            
            addBed() {
                this.garden.addBed();
                this.save();
                this.render();
            },
            
            removeBed(bedId) {
                if (confirm(this.t('bed.remove'))) {
                    this.garden.removeBed(bedId);
                    this.save();
                    this.render();
                }
            },
            
            openBedModal(bedId) {
                const bed = this.garden.beds.get(bedId);
                if (!bed) return;
                
                const modal = document.getElementById('bedModal');
                const modalBody = document.getElementById('modalBody');
                
                modalBody.innerHTML = `
                    <div class="form-group">
                        <label>${this.t('modal.bedName')}</label>
                        <input type="text" id="bedNameInput" value="${bed.name}" style="width: 100%;">
                    </div>
                    <div class="form-group">
                        <label>${this.t('modal.assignPlantsFor')} ${this.currentYear}</label>
                        <select id="plantSelect" style="width: 100%;">
                            <option value="">${this.t('modal.selectPlant')}</option>
                            ${Array.from(this.garden.vegetables.values())
                                .sort((a, b) => a.getName(this.currentLanguage).localeCompare(b.getName(this.currentLanguage)))
                                .map(veg => `<option value="${veg.id}">${veg.getName(this.currentLanguage)}</option>`)
                                .join('')}
                        </select>
                        <button class="btn btn-primary" style="margin-top: 0.5rem;" onclick="app.addPlantToBed(${bedId})">${this.t('modal.addPlant')}</button>
                    </div>
                    <div id="bedPlantsList">
                        ${this.renderBedPlantsList(bedId)}
                    </div>
                    <button class="btn btn-primary" style="width: 100%; margin-top: 1rem;" onclick="app.saveBed(${bedId})">${this.t('modal.save')}</button>
                `;
                
                modal.classList.add('active');
            },
            
            renderBedPlantsList(bedId) {
                const vegIds = this.garden.getPlantingIdsForBed(bedId, this.currentYear);
                
                if (vegIds.length === 0) {
                    return `<p style="color: var(--soil-medium); font-style: italic; margin-top: 1rem;">${this.t('modal.noPlants')}</p>`;
                }
                
                return `
                    <div style="margin-top: 1rem;">
                        <strong>${this.t('modal.currentPlants')} (${this.currentYear}):</strong>
                        ${vegIds.map(vegId => {
                            const veg = this.garden.vegetables.get(vegId);
                            if (!veg) return '';
                            return `
                                <div style="background: var(--cream); padding: 0.75rem; margin: 0.5rem 0; border-radius: 6px; display: flex; justify-content: space-between; align-items: center;">
                                    <span>${veg.getName(this.currentLanguage)} <span style="font-size: 0.8rem; color: var(--soil-medium);">(${veg.family})</span></span>
                                    <button onclick="app.removePlantFromBed(${bedId}, '${vegId}')" style="background: var(--terracotta); color: white; border: none; padding: 0.25rem 0.75rem; border-radius: 4px; cursor: pointer;">${this.t('modal.remove')}</button>
                                </div>
                            `;
                        }).join('')}
                    </div>
                `;
            },
            
            addPlantToBed(bedId) {
                const select = document.getElementById('plantSelect');
                const vegId = select.value;
                if (!vegId) return;
                
                this.garden.addPlanting(bedId, this.currentYear, vegId);
                select.value = '';
                
                const modalBody = document.getElementById('modalBody');
                modalBody.querySelector('#bedPlantsList').innerHTML = this.renderBedPlantsList(bedId);
                
                this.save();
            },
            
            removePlantFromBed(bedId, vegId) {
                this.garden.removePlanting(bedId, this.currentYear, vegId);
                
                const modalBody = document.getElementById('modalBody');
                modalBody.querySelector('#bedPlantsList').innerHTML = this.renderBedPlantsList(bedId);
                
                this.save();
            },
            
            saveBed(bedId) {
                const bed = this.garden.beds.get(bedId);
                const nameInput = document.getElementById('bedNameInput');
                bed.name = nameInput.value;
                this.closeModal();
                this.save();
                this.render();
            },
            
            closeModal() {
                document.getElementById('bedModal').classList.remove('active');
            },
            
            generateSuggestions() {
                if (this.wishlist.length === 0) {
                    alert(this.t('wishlist.empty'));
                    return;
                }
                
                const suggestions = this.suggestionEngine.generateSuggestions(this.wishlist, this.currentYear);
                this.renderSuggestions(suggestions);
            },
            
            renderSuggestions(suggestions) {
                const container = document.getElementById('suggestionsBox');
                
                if (suggestions.length === 0) {
                    container.innerHTML = `
                        <div class="suggestion-box">
                            <h4>${this.t('suggestions.none')}</h4>
                            <p>${this.t('suggestions.noneText')}</p>
                        </div>
                    `;
                    return;
                }
                
                container.innerHTML = `
                    <div class="suggestion-box">
                        <h4>${this.t('suggestions.title')}</h4>
                        ${suggestions.map(s => `
                            <div class="suggestion-item">
                                <strong>${s.bedName}:</strong> ${s.vegetableName}<br>
                                <small style="color: var(--soil-medium); display: block; margin: 0.5rem 0;">
                                    ${s.reasons.slice(0, 2).map(r => this.translateReason(r)).join(' ‚Ä¢ ')}
                                </small>
                                <button class="btn btn-primary" style="margin-top: 0.5rem; padding: 0.5rem 1rem; font-size: 0.85rem;" 
                                        onclick="app.applySuggestion(${s.bedId}, '${s.vegId}')">
                                    ${this.t('suggestions.apply')}
                                </button>
                            </div>
                        `).join('')}
                    </div>
                `;
            },
            
            translateReason(reason) {
                if (reason.includes(':')) {
                    const [key, vegId] = reason.split(':');
                    const veg = this.garden.vegetables.get(vegId);
                    if (veg) {
                        return `${this.t(key)} ${veg.getName(this.currentLanguage)}`;
                    }
                }
                return this.t(reason);
            },
            
            applySuggestion(bedId, vegId) {
                this.garden.addPlanting(bedId, this.currentYear, vegId);
                this.save();
                this.render();
            },
            
            showMatrix() {
                const modal = document.getElementById('matrixModal');
                const body = document.getElementById('matrixBody');
                
                const veggies = Array.from(this.garden.vegetables.values())
                    .sort((a, b) => a.getName(this.currentLanguage).localeCompare(b.getName(this.currentLanguage)));
                
                let html = `
                    <div class="compatibility-matrix">
                        <table class="compatibility-table">
                            <thead>
                                <tr>
                                    <th>Plant</th>
                                    ${veggies.map(v => `<th>${v.getName(this.currentLanguage)}</th>`).join('')}
                                </tr>
                            </thead>
                            <tbody>
                `;
                
                veggies.forEach(rowVeg => {
                    html += `<tr><th>${rowVeg.getName(this.currentLanguage)}</th>`;
                    veggies.forEach(colVeg => {
                        if (rowVeg.id === colVeg.id) {
                            html += '<td class="compat-neutral">-</td>';
                        } else {
                            const compat = rowVeg.isCompatibleWith(colVeg.id);
                            if (compat === 1) {
                                html += '<td class="compat-good">‚úì</td>';
                            } else if (compat === -1) {
                                html += '<td class="compat-bad">‚úó</td>';
                            } else {
                                html += '<td class="compat-neutral">‚óã</td>';
                            }
                        }
                    });
                    html += '</tr>';
                });
                
                html += `
                            </tbody>
                        </table>
                    </div>
                    <div style="margin-top: 1rem; font-size: 0.9rem;">
                        <strong>${this.t('matrix.legend')}:</strong> ‚úì = ${this.t('matrix.good')} | ‚úó = ${this.t('matrix.bad')} | ‚óã = ${this.t('matrix.neutral')}
                    </div>
                `;
                
                body.innerHTML = html;
                modal.classList.add('active');
            },
            
            closeMatrixModal() {
                document.getElementById('matrixModal').classList.remove('active');
            },
            
            exportData() {
                const data = this.garden.exportData();
                const blob = new Blob([data], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `${this.t('export.filename')}-${new Date().toISOString().split('T')[0]}.json`;
                a.click();
                URL.revokeObjectURL(url);
            },
            
            importData() {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = '.json';
                input.onchange = (e) => {
                    const file = e.target.files[0];
                    if (!file) return;
                    
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        const success = this.garden.importData(event.target.result);
                        if (success) {
                            alert(this.t('import.success'));
                            this.save();
                            this.render();
                        } else {
                            alert(this.t('import.error'));
                        }
                    };
                    reader.readAsText(file);
                };
                input.click();
            },
            
            installAsApp() {
                // Check if already running as PWA
                if (window.matchMedia('(display-mode: standalone)').matches) {
                    alert(this.t('install.alreadyInstalled'));
                    return;
                }
                
                // Try PWA installation
                if (window.deferredPrompt) {
                    window.deferredPrompt.prompt();
                    window.deferredPrompt.userChoice.then((choiceResult) => {
                        if (choiceResult.outcome === 'accepted') {
                            console.log('App was installed');
                        }
                        window.deferredPrompt = null;
                        document.getElementById('headerInstallButton').style.display = 'none';
                    });
                } else {
                    // Fallback: Show manual installation instructions
                    this.showInstallationInstructions();
                }
            },
            
            showInstallationInstructions() {
                const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
                const isAndroid = /Android/.test(navigator.userAgent);
                
                let instructions = '';
                
                if (isIOS) {
                    instructions = this.t('install.iosTitle') + '\n\n' + this.t('install.iosSteps');
                } else if (isAndroid) {
                    instructions = this.t('install.androidTitle') + '\n\n' + this.t('install.androidSteps');
                } else {
                    instructions = this.t('install.desktopTitle') + '\n\n' + this.t('install.desktopSteps');
                }
                
                alert(instructions);
            },
            
            save() {
                this.garden.saveToLocalStorage();
                localStorage.setItem('beetAnythingState', JSON.stringify({
                    currentYear: this.currentYear,
                    wishlist: this.wishlist,
                    language: this.currentLanguage
                }));
            },
            
            render() {
                const grid = document.getElementById('gardenGrid');
                const beds = Array.from(this.garden.beds.values());
                
                if (beds.length === 0) {
                    grid.innerHTML = `<p class="empty-bed">${this.t('bed.empty')}</p>`;
                    return;
                }
                
                grid.innerHTML = beds.map(bed => {
                    const currentPlantings = this.garden.getPlantingsForBed(bed.id, this.currentYear);
                    const prevPlantings = this.garden.getPlantingsForBed(bed.id, this.currentYear - 1);
                    
                    let content = '';
                    if (currentPlantings.length === 0) {
                        content = `<div class="empty-bed">${this.t('bed.empty')}</div>`;
                    } else {
                        content = currentPlantings.map(veg => {
                            const currentIds = currentPlantings.map(v => v.id);
                            const goodCompanions = currentIds.filter(id => id !== veg.id && veg.isCompatibleWith(id) === 1);
                            const badCompanions = currentIds.filter(id => id !== veg.id && veg.isCompatibleWith(id) === -1);
                            
                            return `
                                <div class="plant-assignment">
                                    <div class="plant-name">${veg.getName(this.currentLanguage)}</div>
                                    <div class="plant-meta">
                                        <span class="nutrition-badge nutrition-${veg.nutrition}">
                                            ${this.t(`nutrition.${veg.nutrition}`)}
                                        </span>
                                        <span>${veg.family}</span>
                                    </div>
                                    ${goodCompanions.length > 0 ? `
                                        <div class="companions-list">
                                            ${goodCompanions.map(id => {
                                                const c = this.garden.vegetables.get(id);
                                                return c ? `<span class="companion-tag companion-good">‚úì ${c.getName(this.currentLanguage)}</span>` : '';
                                            }).join('')}
                                        </div>
                                    ` : ''}
                                    ${badCompanions.length > 0 ? `
                                        <div class="companions-list">
                                            ${badCompanions.map(id => {
                                                const c = this.garden.vegetables.get(id);
                                                return c ? `<span class="companion-tag companion-bad">‚úó ${c.getName(this.currentLanguage)}</span>` : '';
                                            }).join('')}
                                        </div>
                                    ` : ''}
                                </div>
                            `;
                        }).join('');
                    }
                    
                    let prevYearInfo = '';
                    if (prevPlantings.length > 0) {
                        prevYearInfo = `
                            <div style="font-size: 0.8rem; color: var(--soil-medium); margin-top: 0.5rem; padding-top: 0.5rem; border-top: 1px solid var(--sage);">
                                ${this.t('bed.previous')} (${this.currentYear - 1}): ${prevPlantings.map(v => v.getName(this.currentLanguage)).join(', ')}
                            </div>
                        `;
                    }
                    
                    return `
                        <div class="bed" onclick="app.openBedModal(${bed.id})">
                            <div class="bed-header">
                                <div class="bed-name">${bed.name}</div>
                                <div class="bed-actions">
                                    <button onclick="event.stopPropagation(); app.removeBed(${bed.id})" title="Remove bed">üóëÔ∏è</button>
                                </div>
                            </div>
                            <div class="bed-content">
                                ${content}
                                ${prevYearInfo}
                            </div>
                        </div>
                    `;
                }).join('');
                
                this.renderWishlist();
            }
        };
        
        // Initialize app
        app.init();
        
        // ============================================
        // PWA SERVICE WORKER & INSTALLATION
        // ============================================
        
        // Service Worker registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                const swCode = `
                    const CACHE_NAME = 'beet-anything-v1';
                    const urlsToCache = ['./', 'index.html'];
                    
                    self.addEventListener('install', (event) => {
                        event.waitUntil(
                            caches.open(CACHE_NAME)
                                .then((cache) => cache.addAll(urlsToCache))
                        );
                    });
                    
                    self.addEventListener('fetch', (event) => {
                        event.respondWith(
                            caches.match(event.request)
                                .then((response) => response || fetch(event.request))
                        );
                    });
                `;
                
                const blob = new Blob([swCode], { type: 'application/javascript' });
                const swUrl = URL.createObjectURL(blob);
                
                navigator.serviceWorker.register(swUrl)
                    .then(reg => console.log('Service Worker registered'))
                    .catch(err => console.log('Service Worker error:', err));
            });
        }
        
        // PWA Installation
        let deferredPrompt;
        window.deferredPrompt = null;
        
        const installButton = document.createElement('button');
        installButton.id = 'floatingInstallButton';
        installButton.className = 'btn btn-primary';
        installButton.innerHTML = 'üì± Install as App';
        installButton.style.cssText = 'position: fixed; bottom: 20px; right: 20px; z-index: 1000; display: none; box-shadow: 0 4px 12px rgba(0,0,0,0.3);';
        document.body.appendChild(installButton);
        
        const headerInstallButton = document.getElementById('headerInstallButton');
        
        // Check if already installed
        if (window.matchMedia('(display-mode: standalone)').matches) {
            console.log('App is already running as PWA');
        } else {
            // Show header button always (for manual installation)
            if (headerInstallButton) {
                headerInstallButton.style.display = 'inline-block';
            }
        }
        
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            window.deferredPrompt = e;
            
            // Show both buttons
            installButton.style.display = 'block';
            if (headerInstallButton) {
                headerInstallButton.style.display = 'inline-block';
            }
        });
        
        installButton.addEventListener('click', async () => {
            if (!deferredPrompt) {
                app.showInstallationInstructions();
                return;
            }
            
            deferredPrompt.prompt();
            const { outcome } = await deferredPrompt.userChoice;
            
            if (outcome === 'accepted') {
                console.log('App was installed');
            }
            
            deferredPrompt = null;
            window.deferredPrompt = null;
            installButton.style.display = 'none';
            if (headerInstallButton) {
                headerInstallButton.style.display = 'none';
            }
        });
        
        // Hide buttons after installation
        window.addEventListener('appinstalled', () => {
            installButton.style.display = 'none';
            if (headerInstallButton) {
                headerInstallButton.style.display = 'none';
            }
            console.log('Beet Anything was installed as an app!');
        });
    </script>
</body>
</html>
